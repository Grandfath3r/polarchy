#!/bin/bash

# Sync Polarchy theme to all Obsidian vaults

CURRENT_THEME_DIR="$HOME/.config/polarchy/current/theme"

[ -f "$CURRENT_THEME_DIR/obsidian.css" ] || exit 0

jq -r '.vaults | values[].path' ~/.config/obsidian/obsidian.json 2>/dev/null | while read -r vault_path; do
  [ -d "$vault_path/.obsidian" ] || continue

  theme_dir="$vault_path/.obsidian/themes/Polarchy"
  mkdir -p "$theme_dir"

  [ -f "$theme_dir/manifest.json" ] || cat >"$theme_dir/manifest.json" <<'EOF'
{
  "name": "Polarchy",
  "version": "1.0.0",
  "minAppVersion": "0.16.0",
  "description": "Automatically syncs with your current Polarchy system theme colors and fonts",
  "author": "Polarchy",
  "authorUrl": "https://polarchy.org"
}
EOF

  cp "$CURRENT_THEME_DIR/obsidian.css" "$theme_dir/theme.css"
done
